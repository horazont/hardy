syntax = "proto3";

import "google/protobuf/timestamp.proto";

package cla;

service cla_sink {
    rpc RegisterCla(RegisterClaRequest) returns (RegisterClaResponse);
    rpc UnregisterCla(UnregisterClaRequest) returns (UnregisterClaResponse);
    rpc ReceiveBundle(ReceiveBundleRequest) returns (ReceiveBundleResponse);
}

message RegisterClaRequest {
    string Name = 1;
    string Ident = 2;
    string Protocol = 3;
    string GrpcAddress = 4;
}

message RegisterClaResponse {
    string Token = 1;
}

message UnregisterClaRequest {
    string Token = 1;
}

message UnregisterClaResponse {
}

message ReceiveBundleRequest {
    string Token = 1;
    bytes Source = 2;
    bytes Bundle = 3;
}

message ReceiveBundleResponse {
}

service cla {
    rpc ForwardBundle(ForwardBundleRequest) returns (ForwardBundleResponse);
}

message ForwardBundleRequest {
    string Token = 1;
    bytes Destination = 2;
    bytes Bundle = 3;
}

message ForwardBundleResponse {
    optional google.protobuf.Timestamp retry_at = 1;
}
